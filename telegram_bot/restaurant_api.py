import requests
import datetime


def get_reaktori_menu():
    """ Prints Reaktori's menu"""
    language = "fi"
    url = "https://www.foodandco.fi/modules/json/json/Index?costNumber=0812&language={}".format(language)
    response = requests.get(url)
    data = response.json()["MenusForDays"]
    date = datetime.datetime.now().strftime("%y-%m-%d")
    formated_menu = ""
    for day in data:
        if date in day["Date"]:
            if not day["LunchTime"]:
                formated_menu += "It looks like the restaurant is closed today. "
                break
            for menu in day["SetMenus"]:
                name = menu["Name"].split('(')[0]
                formated_menu += "\n<b>{}</b>\n".format(name)
                for component in menu["Components"]:
                    component = component.split('(')[0]
                    formated_menu += "\t\t{}\n".format(component)
    return formated_menu


def get_hertsi_menu():
    """ Prints Hertsi's menu"""
    url = "https://www.sodexo.fi/en/ruokalistat/output/weekly_json/111"
    response = requests.get(url)
    data = response.json()["mealdates"]
    current_weekday = datetime.datetime.today().strftime('%A')
    formated_menu = ""
    for day in data:
        if current_weekday == day["date"]:
            for menu_num in day["courses"]:
                menu = day["courses"][menu_num]
                formated_menu += "\n<b>{}</b>\n".format(menu["title_fi"])
    if not formated_menu:
        formated_menu += "It looks like the restaurant is closed today. "
    return formated_menu


# RESP = [{"kitchenName":"Ravintola Newton","kitchenId":6,"address":"","city":"","email":"","phone":"","info":"","menuTypes":[{"menuTypeId":12,"menuTypeName":"Ateriapalvelut koulu","menus":[{"menuName":"Etelä-Hervannan koulu Tampere","menuAdditionalName":"BI 19.9.2022-28.10.2022","menuId":2944,"days":[{"date":20221007,"weekday":5,"mealoptions":[{"name":"LOUNAS I","orderNumber":8,"id":3,"menuItems":[{"name":"Jauhelihapihvi","orderNumber":1,"portionSize":80,"diets":"L, M, Mu, *","ingredients":"Jauhelihapihvi (liha 52 % (viljaporsas, broileri, nauta), vesi, SOIJAPROTEIINI, perunajauho, korppujauho (VEHNÄ), rypsiöljy, mausteet (sipuli, mustapippuri, paprika, maustepippuri, lipstikka, sarviapila), emulgointiaine auringonkukkalesitiini, jodioitu suola, sokeri, karamellisoitu sokeri, happamuudensäätöaineet (kaliumkloridi, E 300), VEHNÄKUITU, aromit. Viljaporsaan-, naudan- ja broilerinlihan alkuperä Suomi) <strong>(Gluteeni, Soijapapu, vehnä)</strong>"},{"name":"Peruna","orderNumber":2,"portionSize":66,"diets":"G, M, Mu, *, VEG","ingredients":"Peruna (peruna, hapettumisenestoaine (NATRIUMDISULFIITTI)) <strong>(Rikkidioksidi)</strong>"},{"name":"Tomaattikastike","orderNumber":3,"portionSize":95,"diets":"G, M, Mu, VEG","ingredients":"Vesi, Tomatino-kastike (Tomaattisose* 84%, tomaatti* 10%, auringonkukkaöljy, sokeri, sipuli 1,1%, suola, happo (sitruunahappo). *Kestävillä viljelysmenetelmillä kasvatetuista tomaateista.), Maissitärkkelys, Vaalea kastikeaines (Maissitärkkelys, muunnettu perunatärkkelys, maltodekstriini, suola, kasvisrasvat (palmurasva, karitevoi), emulgointiaine (E 451), hiivauute, muunnettu maissitärkkelys, aromi, väriaine (E 150c), kurkuma, riisijauho.), Sokeri (sokeri), Vähäsuolainen kasvisliemijauhe (Suola, maltodekstriini, sipuli 10 %, luontainen aromi, palsternakka 5,2 %, porkkana 4,6 %, purjo 0,3 %. Kasvikset 20 %.), Suola (Ruokasuola ja paakkuuntumisenestoaine (E 536). Valmistettu vakuumisuolasta lisäämällä jodia kaliumjodidina.), Valkosipulimurska (Valkosipuli 80%, vesi, säilöntäaine: kaliumsorbaatti, stabilointiaine: sitruunahappo.), Mustapippurirouhe (Mustapippuri.), Rakuuna (Rakuuna.)"}]},{"name":"LOUNAS II","orderNumber":10,"id":4,"menuItems":[{"name":"Kanapuikko","orderNumber":1,"portionSize":17,"diets":"M","ingredients":"Kanapuikko (koneellisesti eroteltu siipikarjanliha (Suomi), broilerinliha (17 %), vesi, SOIJAPROTEIINIVALMISTE, korppujauho (VEHNÄ), kasvirasvavalmiste (vesi, kookosöljy, peruna-, maissi- ja tapiokatärkkelys, sakeuttamisaine ksantaanikumi, suola, säilöntäaine kaliumsorbaatti, väriaine (E160 b)), mausteet (valkopippuri, tomaatti, sipuli, valkosipuli, maustepippuri), siipikarjanrasva, jodioitu suola, dekstroosi, aromit, karamellisoitu sokeri, rypsiöljy. Broilerinlihan alkuperä Suomi) <strong>(Gluteeni, Soijapapu, vehnä)</strong>"}]},{"name":"LOUNAS KASVIS","orderNumber":14,"id":5,"menuItems":[{"name":"Kasvispihvi","orderNumber":1,"portionSize":4,"diets":"M, *","ingredients":"Kasvispihvi (Porkkana, KANANMUNA, kaali, sipuli, SOIJAproteiinivalmiste, kasvimargariini (rypsiöljy, kovetettu rypsiöljy, aromi), juuriSELLERI, palsternakka, perunajauho, maissirae, perunahiutale, jodioitu suola, mausteet (mm. valkosipuli, paprika, valkopippuri), sokeri. Kasvispitoisuus 74 %.) <strong>(Muna, Selleri, Soijapapu)</strong>"},{"name":"Tomaattikastike","orderNumber":2,"portionSize":5,"diets":"G, M, Mu, VEG","ingredients":"Vesi, Tomatino-kastike (Tomaattisose* 84%, tomaatti* 10%, auringonkukkaöljy, sokeri, sipuli 1,1%, suola, happo (sitruunahappo). *Kestävillä viljelysmenetelmillä kasvatetuista tomaateista.), Maissitärkkelys, Vaalea kastikeaines (Maissitärkkelys, muunnettu perunatärkkelys, maltodekstriini, suola, kasvisrasvat (palmurasva, karitevoi), emulgointiaine (E 451), hiivauute, muunnettu maissitärkkelys, aromi, väriaine (E 150c), kurkuma, riisijauho.), Sokeri (sokeri), Vähäsuolainen kasvisliemijauhe (Suola, maltodekstriini, sipuli 10 %, luontainen aromi, palsternakka 5,2 %, porkkana 4,6 %, purjo 0,3 %. Kasvikset 20 %.), Suola (Ruokasuola ja paakkuuntumisenestoaine (E 536). Valmistettu vakuumisuolasta lisäämällä jodia kaliumjodidina.), Valkosipulimurska (Valkosipuli 80%, vesi, säilöntäaine: kaliumsorbaatti, stabilointiaine: sitruunahappo.), Mustapippurirouhe (Mustapippuri.), Rakuuna (Rakuuna.)"},{"name":"Peruna","orderNumber":3,"portionSize":100,"diets":"G, M, Mu, *, VEG","ingredients":"Peruna (peruna, hapettumisenestoaine (NATRIUMDISULFIITTI)) <strong>(Rikkidioksidi)</strong>"}]},{"name":"SALAATTI","orderNumber":38,"id":12,"menuItems":[{"name":"Punajuuri-omenasalaatti","orderNumber":1,"portionSize":36,"diets":"G, L, M, Mu, VEG","ingredients":"Punajuurikuutio mausteliemessä (Punajuuri, vesi, sokeri, happo (etikkahappo), säilöntäaine (kaliumsorbaatti), neilikka-aromi.), Omena (puolalainen omena, hapettumisenestoaineet (E300, E330))"},{"name":"Kaali","orderNumber":2,"portionSize":20,"diets":"G, M, Mu, VEG","ingredients":"Kaali (Valkokaali)"}]},{"name":"VÄLIPALA","orderNumber":45,"id":23,"menuItems":[{"name":"Maustamaton jogurtti","orderNumber":1,"portionSize":100,"diets":"G, L, Mu","ingredients":"Maustamaton jogurtti (pastöroitu suomalainen rasvaton LUOMUMAITO, jogurttihapate, Lactobacillus acidophilus ja Bifidobacterium sp.) <strong>(Maito)</strong>"},{"name":"Mangosose","orderNumber":2,"portionSize":30,"diets":"G, M, Mu, VEG","ingredients":"Mangosose (mango (100 %, muu kuin EU))"},{"name":"Kurkku","orderNumber":3,"portionSize":20,"diets":"G, VEG","ingredients":"Kurkku (suomalainen kurkku)"}]}]}]}]},{"menuTypeId":56,"menuTypeName":"Lounas","menus":[{"menuName":"Ravintola Newton ROHEE","menuAdditionalName":"BI 19.9.2022 - 28.10.2022","menuId":2943,"days":[{"date":20221007,"weekday":5,"mealoptions":[{"name":"LOUNAS I","orderNumber":8,"id":3,"menuItems":[{"name":"Jauhelihapihvi","orderNumber":1,"portionSize":105,"diets":"L, M, Mu, *","ingredients":"Jauhelihapihvi (liha 52 % (viljaporsas, broileri, nauta), vesi, SOIJAPROTEIINI, perunajauho, korppujauho (VEHNÄ), rypsiöljy, mausteet (sipuli, mustapippuri, paprika, maustepippuri, lipstikka, sarviapila), emulgointiaine auringonkukkalesitiini, jodioitu suola, sokeri, karamellisoitu sokeri, happamuudensäätöaineet (kaliumkloridi, E 300), VEHNÄKUITU, aromit. Viljaporsaan-, naudan- ja broilerinlihan alkuperä Suomi) <strong>(Gluteeni, Soijapapu, vehnä)</strong>"},{"name":"Kermainen pippurikastike","orderNumber":2,"portionSize":106,"diets":"G, L, Mu","ingredients":"Vesi, Ruokakerma (Vesi, KIRNUMAITO, kasviöljyt (rypsi ja palmu#), muunnettu tärkkelys, emulgointiaine (rasvahappojen mono- ja diglyseridit (kasvirasvapohjainen)), stabilointiaineet (metyyliselluloosa, guarkumi), happamuudensäätöaineet (natriumsitraatti, sitruunahappo), laktaasientsyymi, aromi. #Kestävän kehityksen mukaisesti tuotettua ja sertifioitua palmuöljyä. Lue lisää: www.ufs.com/vastuullisuus) <strong>(Maito)</strong>, Ruskea kastikeaines (Maltodekstriini, muunnettu perunatärkkelys, maissitärkkelys, suola, kasvirasvat (palmurasva, karitevoi), väriaine (E 150c), sipuli, sokeri, emulgointiaine (E 451), muunnettu maissitärkkelys, happo (sitruunahappo), aromi.), Tomaattisose (tomaatti), Vähäsuolainen lihaliemijauhe (Maltodekstriini, suola, luontainen aromi, naudanlihauute 8,9 %, sipuli.), Sokeri (sokeri), Mustapippurirouhe (Mustapippuri.), Suola (Ruokasuola ja paakkuuntumisenestoaine (E 536). Valmistettu vakuumisuolasta lisäämällä jodia kaliumjodidina.)"},{"name":"Keitetyt perunat","orderNumber":3,"portionSize":92,"diets":"G, M, Mu, *, VEG","ingredients":"Peruna (Peruna)"},{"name":"Päivän lämmin kasvislisäke","orderNumber":4,"portionSize":61,"diets":"","ingredients":"***"}]},{"name":"LOUNAS II","orderNumber":10,"id":4,"menuItems":[{"name":"Broileri-curry-kookoskastike","orderNumber":1,"portionSize":107,"diets":"G, L, M, Mu, *","ingredients":"Vesi, Broilerin fileesuikale (suomalainen broilerinfilee, jodioitu suola.100 g:aan tuotetta käytetty 113 g lihaa.LAKTOOSITON. GLUTEENITON. RUNSASPROTEIININEN.), Vihannessekoitus (Porkkanaviipale poimutettu 15-27mm (35%), parsakaali 20-40mm(25%), romano-papupala 20-40mm (20%), punainen paprikasuikale (10%), minimaissipala (10%).), Kookosmaito (kookospähkinäuute (75 %), vesi, emulgointiaine (E471), stabilointiaine (E466).), Punainen paparika (keltainen paprika (33%), punainen paprika (33%), vihreä paprika (33%)), Maissitärkkelys, Vähäsuolainen kanaliemijauhe (Maltodekstriini, suola, luontainen aromi, sipuli, jauhettu kananliha 2,2 %, hapettumisenestoaine: rosmariiniuute.), Sokeri (sokeri), Suola (Ruokasuola ja paakkuuntumisenestoaine (E 536). Valmistettu vakuumisuolasta lisäämällä jodia kaliumjodidina.), Curry (Korianteri (34%), kurkuma (31%), sarviapila, cayennepippuri, juustokumina, fenkoli, mustapippuri.)"},{"name":"Täysjyväriisi","orderNumber":2,"portionSize":65,"diets":"G, L, M, Mu, *, VEG","ingredients":"Vesi, Tummariisi (parboil-käsitelty pitkäjyväinen tumma riisi), Rypsiöljy (rapsiöljy (siemen: eu)), Suola (Ruokasuola ja paakkuuntumisenestoaine (E 536). Valmistettu vakuumisuolasta lisäämällä jodia kaliumjodidina.)"},{"name":"Päivän lämmin kasvislisäke","orderNumber":3,"portionSize":50,"diets":"","ingredients":"***"}]}]}]}]},{"menuTypeId":110,"menuTypeName":"Kasvis","menus":[{"menuName":"Ravintola Newton #EATYOURGREENS","menuAdditionalName":"BI 19.9.2022 - 28.10.2022","menuId":2945,"days":[{"date":20221007,"weekday":5,"mealoptions":[{"name":"LOUNAS KASVIS LINJA 4","orderNumber":99,"id":96,"menuItems":[{"name":"Kasvispyörykät","orderNumber":1,"portionSize":16,"diets":"G, M, *","ingredients":"Kasvispyörykät (Porkkana, KANANMUNA, palsternakka, sipuli, SEESAMINSIEMEN, SOIJAproteiinivalmisteet, rypsiöljy, perunajauho, perunahiutale, kasvimargariini (rypsiöljy, kovetettu rypsiöljy, aromi), jodioitu suola, mausteet (mm. valkopippuri). Kasvispitoisuus 69 %.) <strong>(Muna, Seesaminsiemen, Soijapapu)</strong>"},{"name":"Höyryperunat","orderNumber":2,"portionSize":285,"diets":"G, M, Mu, *, VEG","ingredients":"Peruna (Peruna)"},{"name":"Tsatsiki-kastike","orderNumber":3,"portionSize":80,"diets":"G, L, Mu","ingredients":"Kurkku (suomalainen kurkku), Kermaviili (pastöroitu KERMA, hapate) <strong>(Maito)</strong>, Maustamaton jogurtti (pastöroitu suomalainen rasvaton LUOMUMAITO, jogurttihapate, Lactobacillus acidophilus ja Bifidobacterium sp.) <strong>(Maito)</strong>, Sokeri (sokeri), Sitruunamehu (Sitruunatäysmehu tiivisteestä, C-vitamiini.), Valkosipulimurska (Valkosipuli 80%, vesi, säilöntäaine: kaliumsorbaatti, stabilointiaine: sitruunahappo.), Väkiviinaetikka (Väkiviinaetikka. Etikkahappopitoisuus 10 %), Suola (Ruokasuola ja paakkuuntumisenestoaine (E 536). Valmistettu vakuumisuolasta lisäämällä jodia kaliumjodidina.), Mustapippurirouhe (Mustapippuri.), Persilja (Persilja.), Sitruunapippuri (Mustapippuri (56%), happo (sitruunahappo), sipuli, sokeri, sitruunamehujauhe (0,8%).)"},{"name":"Päivän lämmin kasvislisäke","orderNumber":4,"portionSize":50,"diets":"","ingredients":"***"}]}]}]}]}]}]
def get_newton_menu():
    """ Prints Newton's menu"""
    formated_menu = ""
    date = datetime.datetime.now().strftime("%Y%m%d")
    url = "https://fi.jamix.cloud/apps/menuservice/rest/haku/menu/93077/6/?lang=fi&date={}&date2={}".format(date, date)
    response = requests.get(url)
    try:
        data = response.json()[0]["menuTypes"]
    except IndexError:
        data = {}
    for menu_name in data:
        if menu_name["menuTypeName"] in ["Lounas", "Kasvis", "Konehuone"]:
            meal_list = menu_name["menus"][0]["days"][0]["mealoptions"]
            for meal in meal_list:
                formated_menu += "\n<b>{}</b>\n".format(meal["name"])
                for recipe in meal["menuItems"]:
                    formated_menu += "\t\t{}\n".format(recipe["name"])
    if not formated_menu:
        formated_menu += "It looks like the restaurant is closed today. "
    return formated_menu
